!function(i,t){t.LikeButton={exec:function(){i(document).ready(i.proxy(this.onDomReady,this)),i(document).on("fcx:template-loader:finished-loading:photo-meta",i.proxy(this.onDomReady,this)),i(document).on("fcx:template-loader:finished-loading:photo-list",i.proxy(this.onDomReady,this)),i(document).on("fcx:finished-loading:news-stream",i.proxy(this.onDomReady,this)),i(document).on("keyup",i.proxy(this.onKeyUp,this))},onKeyUp:function(t){0===i("#fcx-photo-wrapper").length&&0===i(".fcx-search-detail").is(":hidden")||76===t.keyCode&&(i("textarea").is(":focus")||i('[contenteditable="true"]').is(":focus")||"true"===i(document.activeElement).attr("contenteditable")||i("input").is(":focus")||(this.$likeButton.is(":hidden")||(url=i(".btn.fcx-like").data("href")),this.$unlikeButton.is(":hidden")||(url=i(".btn.fcx-unlike").data("href")),this.toggleLike(url,t)))},onDomReady:function(){this.init(),this.bindEvents()},init:function(){this.$likeButtons=i(".btn.fcx-like, .btn.fcx-unlike",document),this.$likeButton=i(".fcx-photo-meta").find(".btn.fcx-like"),this.$unlikeButton=i(".fcx-photo-meta").find(".btn.fcx-unlike"),this.xhrPool=[]},bindEvents:function(){this.$likeButtons.off("click"),this.$likeButtons.on("click",i.proxy(this.onLikeOrUnlike,this))},onLikeOrUnlike:function(t){t.preventDefault(),t.stopPropagation(),this.toggleLike(i(t.currentTarget).data("href"),t)},toggleLike:function(t,e){for(0<parseInt(i(e.currentTarget).data("id"))?this.$likeButtonToToggle=this.$likeButtons.filter("[data-id='"+i(e.currentTarget).data("id")+"']"):this.$likeButtonToToggle=this.$likeButtons,this.$likeButtonToToggle.toggleClass("hidden"),i(".fcx-appreciate-count-default").text(parseInt(this.$likeButtonToToggle.find(".fcx-appreciate-count:visible").text(),10)||0);0<this.xhrPool.length;)this.xhrPool.pop().abort();ajax=i.ajax({url:t,context:this,type:"POST"}).success(this.onSuccess),this.xhrPool.push(ajax)},onSuccess:function(){this.reloadLikes()},reloadLikes:function(){i.ajax({url:i("#likes").data("ajax-url"),context:this,type:"GET"}).success(this.onReloadSuccess)},onReloadSuccess:function(t){i("#likes").replaceWith(t)}},t.LikeButton.exec()}(jQuery,window.FOTOCOMMUNITY=window.FOTOCOMMUNITY||{});